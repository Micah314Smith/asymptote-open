/*@license
@fileoverview gl-matrix - High performance matrix and vector operations
@author Brandon Jones
@author Colin MacKenzie IV
@version 2.7.0

Copyright (c) 2015-2018, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
/*@license
 gl.js: Render Bezier patches via subdivision with WebGL.
  Copyright 2019: John C. Bowman and Supakorn "Jamie" Rassameemasmuang
  University of Alberta

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
let gl,canvas,canvasWidth,canvasHeight,halfCanvasWidth,halfCanvasHeight;!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var a in r)("object"==typeof exports?exports:t)[a]=r[a]}}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=10)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=function(t){e.ARRAY_TYPE=t},e.toRadian=function(t){return t*n},e.equals=function(t,e){return Math.abs(t-e)<=a*Math.max(1,Math.abs(t),Math.abs(e))};var a=e.EPSILON=1e-6;e.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,e.RANDOM=Math.random;var n=Math.PI/180},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=n,e.clone=function(t){var e=new a.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.fromValues=function(t,e,r,n){var i=new a.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.set=function(t,e,r,a,n){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},e.subtract=i,e.multiply=s,e.divide=o,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},e.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t},e.distance=h,e.squaredDistance=u,e.length=c,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},e.normalize=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r*r+a*a+n*n+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=r*s,t[1]=a*s,t[2]=n*s,t[3]=i*s),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},e.lerp=function(t,e,r,a){var n=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n+a*(r[0]-n),t[1]=i+a*(r[1]-i),t[2]=s+a*(r[2]-s),t[3]=o+a*(r[3]-o),t},e.random=function(t,e){var r,n,i,s,o,h;e=e||1;do{o=(r=2*a.RANDOM()-1)*r+(n=2*a.RANDOM()-1)*n}while(o>=1);do{h=(i=2*a.RANDOM()-1)*i+(s=2*a.RANDOM()-1)*s}while(h>=1);var u=Math.sqrt((1-o)/h);return t[0]=e*r,t[1]=e*n,t[2]=e*i*u,t[3]=e*s*u,t},e.transformMat4=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3];return t[0]=r[0]*a+r[4]*n+r[8]*i+r[12]*s,t[1]=r[1]*a+r[5]*n+r[9]*i+r[13]*s,t[2]=r[2]*a+r[6]*n+r[10]*i+r[14]*s,t[3]=r[3]*a+r[7]*n+r[11]*i+r[15]*s,t},e.transformQuat=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=r[0],o=r[1],h=r[2],u=r[3],c=u*a+o*i-h*n,l=u*n+h*a-s*i,f=u*i+s*n-o*a,m=-s*a-o*n-h*i;return t[0]=c*u+m*-s+l*-h-f*-o,t[1]=l*u+m*-o+f*-s-c*-h,t[2]=f*u+m*-h+c*-o-l*-s,t[3]=e[3],t},e.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],o=e[0],h=e[1],u=e[2],c=e[3];return Math.abs(r-o)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-h)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-u)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-c)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))};var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function n(){var t=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function s(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function o(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function h(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2],i=e[3]-t[3];return Math.sqrt(r*r+a*a+n*n+i*i)}function u(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2],i=e[3]-t[3];return r*r+a*a+n*n+i*i}function c(t){var e=t[0],r=t[1],a=t[2],n=t[3];return Math.sqrt(e*e+r*r+a*a+n*n)}function l(t){var e=t[0],r=t[1],a=t[2],n=t[3];return e*e+r*r+a*a+n*n}e.sub=i,e.mul=s,e.div=o,e.dist=h,e.sqrDist=u,e.len=c,e.sqrLen=l,e.forEach=function(){var t=n();return function(e,r,a,n,i,s){var o,h=void 0;for(r||(r=4),a||(a=0),o=n?Math.min(n*r+a,e.length):e.length,h=a;h<o;h+=r)t[0]=e[h],t[1]=e[h+1],t[2]=e[h+2],t[3]=e[h+3],i(t,t,s),e[h]=t[0],e[h+1]=t[1],e[h+2]=t[2],e[h+3]=t[3];return e}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=n,e.clone=function(t){var e=new a.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.length=i,e.fromValues=s,e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.set=function(t,e,r,a){return t[0]=e,t[1]=r,t[2]=a,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},e.subtract=o,e.multiply=h,e.divide=u,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},e.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t},e.distance=c,e.squaredDistance=l,e.squaredLength=f,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},e.normalize=m,e.dot=d,e.cross=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=r[0],o=r[1],h=r[2];return t[0]=n*h-i*o,t[1]=i*s-a*h,t[2]=a*o-n*s,t},e.lerp=function(t,e,r,a){var n=e[0],i=e[1],s=e[2];return t[0]=n+a*(r[0]-n),t[1]=i+a*(r[1]-i),t[2]=s+a*(r[2]-s),t},e.hermite=function(t,e,r,a,n,i){var s=i*i,o=s*(2*i-3)+1,h=s*(i-2)+i,u=s*(i-1),c=s*(3-2*i);return t[0]=e[0]*o+r[0]*h+a[0]*u+n[0]*c,t[1]=e[1]*o+r[1]*h+a[1]*u+n[1]*c,t[2]=e[2]*o+r[2]*h+a[2]*u+n[2]*c,t},e.bezier=function(t,e,r,a,n,i){var s=1-i,o=s*s,h=i*i,u=o*s,c=3*i*o,l=3*h*s,f=h*i;return t[0]=e[0]*u+r[0]*c+a[0]*l+n[0]*f,t[1]=e[1]*u+r[1]*c+a[1]*l+n[1]*f,t[2]=e[2]*u+r[2]*c+a[2]*l+n[2]*f,t},e.random=function(t,e){e=e||1;var r=2*a.RANDOM()*Math.PI,n=2*a.RANDOM()-1,i=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*i,t[1]=Math.sin(r)*i,t[2]=n*e,t},e.transformMat4=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=r[3]*a+r[7]*n+r[11]*i+r[15];return s=s||1,t[0]=(r[0]*a+r[4]*n+r[8]*i+r[12])/s,t[1]=(r[1]*a+r[5]*n+r[9]*i+r[13])/s,t[2]=(r[2]*a+r[6]*n+r[10]*i+r[14])/s,t},e.transformMat3=function(t,e,r){var a=e[0],n=e[1],i=e[2];return t[0]=a*r[0]+n*r[3]+i*r[6],t[1]=a*r[1]+n*r[4]+i*r[7],t[2]=a*r[2]+n*r[5]+i*r[8],t},e.transformQuat=function(t,e,r){var a=r[0],n=r[1],i=r[2],s=r[3],o=e[0],h=e[1],u=e[2],c=n*u-i*h,l=i*o-a*u,f=a*h-n*o,m=n*f-i*l,d=i*c-a*f,M=a*l-n*c,v=2*s;return c*=v,l*=v,f*=v,m*=2,d*=2,M*=2,t[0]=o+c+m,t[1]=h+l+d,t[2]=u+f+M,t},e.rotateX=function(t,e,r,a){var n=[],i=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],i[0]=n[0],i[1]=n[1]*Math.cos(a)-n[2]*Math.sin(a),i[2]=n[1]*Math.sin(a)+n[2]*Math.cos(a),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},e.rotateY=function(t,e,r,a){var n=[],i=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],i[0]=n[2]*Math.sin(a)+n[0]*Math.cos(a),i[1]=n[1],i[2]=n[2]*Math.cos(a)-n[0]*Math.sin(a),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},e.rotateZ=function(t,e,r,a){var n=[],i=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],i[0]=n[0]*Math.cos(a)-n[1]*Math.sin(a),i[1]=n[0]*Math.sin(a)+n[1]*Math.cos(a),i[2]=n[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},e.angle=function(t,e){var r=s(t[0],t[1],t[2]),a=s(e[0],e[1],e[2]);m(r,r),m(a,a);var n=d(r,a);return n>1?0:n<-1?Math.PI:Math.acos(n)},e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2],s=e[0],o=e[1],h=e[2];return Math.abs(r-s)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-h)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))};var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function n(){var t=new a.ARRAY_TYPE(3);return a.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function i(t){var e=t[0],r=t[1],a=t[2];return Math.sqrt(e*e+r*r+a*a)}function s(t,e,r){var n=new a.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=r,n}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function h(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function u(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function c(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+a*a+n*n)}function l(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return r*r+a*a+n*n}function f(t){var e=t[0],r=t[1],a=t[2];return e*e+r*r+a*a}function m(t,e){var r=e[0],a=e[1],n=e[2],i=r*r+a*a+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i),t}function d(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}e.sub=o,e.mul=h,e.div=u,e.dist=c,e.sqrDist=l,e.len=i,e.sqrLen=f,e.forEach=function(){var t=n();return function(e,r,a,n,i,s){var o,h=void 0;for(r||(r=3),a||(a=0),o=n?Math.min(n*r+a,e.length):e.length,h=a;h<o;h+=r)t[0]=e[h],t[1]=e[h+1],t[2]=e[h+2],i(t,t,s),e[h]=t[0],e[h+1]=t[1],e[h+2]=t[2];return e}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0,e.create=h,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},e.setAxisAngle=u,e.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return n>a.EPSILON?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r},e.multiply=c,e.rotateX=function(t,e,r){r*=.5;var a=e[0],n=e[1],i=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=a*h+s*o,t[1]=n*h+i*o,t[2]=i*h-n*o,t[3]=s*h-a*o,t},e.rotateY=function(t,e,r){r*=.5;var a=e[0],n=e[1],i=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=a*h-i*o,t[1]=n*h+s*o,t[2]=i*h+a*o,t[3]=s*h-n*o,t},e.rotateZ=function(t,e,r){r*=.5;var a=e[0],n=e[1],i=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=a*h+n*o,t[1]=n*h-a*o,t[2]=i*h+s*o,t[3]=s*h-i*o,t},e.calculateW=function(t,e){var r=e[0],a=e[1],n=e[2];return t[0]=r,t[1]=a,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-a*a-n*n)),t},e.slerp=l,e.random=function(t){var e=a.RANDOM(),r=a.RANDOM(),n=a.RANDOM(),i=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*r),t[1]=i*Math.cos(2*Math.PI*r),t[2]=s*Math.sin(2*Math.PI*n),t[3]=s*Math.cos(2*Math.PI*n),t},e.invert=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r*r+a*a+n*n+i*i,o=s?1/s:0;return t[0]=-r*o,t[1]=-a*o,t[2]=-n*o,t[3]=i*o,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},e.fromMat3=f,e.fromEuler=function(t,e,r,a){var n=.5*Math.PI/180;e*=n,r*=n,a*=n;var i=Math.sin(e),s=Math.cos(e),o=Math.sin(r),h=Math.cos(r),u=Math.sin(a),c=Math.cos(a);return t[0]=i*h*c-s*o*u,t[1]=s*o*c+i*h*u,t[2]=s*h*u-i*o*c,t[3]=s*h*c+i*o*u,t},e.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"};var a=o(r(0)),n=o(r(5)),i=o(r(2)),s=o(r(1));function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function h(){var t=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function u(t,e,r){r*=.5;var a=Math.sin(r);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(r),t}function c(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[0],h=r[1],u=r[2],c=r[3];return t[0]=a*c+s*o+n*u-i*h,t[1]=n*c+s*h+i*o-a*u,t[2]=i*c+s*u+a*h-n*o,t[3]=s*c-a*o-n*h-i*u,t}function l(t,e,r,n){var i=e[0],s=e[1],o=e[2],h=e[3],u=r[0],c=r[1],l=r[2],f=r[3],m=void 0,d=void 0,M=void 0,v=void 0,p=void 0;return(d=i*u+s*c+o*l+h*f)<0&&(d=-d,u=-u,c=-c,l=-l,f=-f),1-d>a.EPSILON?(m=Math.acos(d),M=Math.sin(m),v=Math.sin((1-n)*m)/M,p=Math.sin(n*m)/M):(v=1-n,p=n),t[0]=v*i+p*u,t[1]=v*s+p*c,t[2]=v*o+p*l,t[3]=v*h+p*f,t}function f(t,e){var r=e[0]+e[4]+e[8],a=void 0;if(r>0)a=Math.sqrt(r+1),t[3]=.5*a,a=.5/a,t[0]=(e[5]-e[7])*a,t[1]=(e[6]-e[2])*a,t[2]=(e[1]-e[3])*a;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var i=(n+1)%3,s=(n+2)%3;a=Math.sqrt(e[3*n+n]-e[3*i+i]-e[3*s+s]+1),t[n]=.5*a,a=.5/a,t[3]=(e[3*i+s]-e[3*s+i])*a,t[i]=(e[3*i+n]+e[3*n+i])*a,t[s]=(e[3*s+n]+e[3*n+s])*a}return t}e.clone=s.clone,e.fromValues=s.fromValues,e.copy=s.copy,e.set=s.set,e.add=s.add,e.mul=c,e.scale=s.scale,e.dot=s.dot,e.lerp=s.lerp;var m=e.length=s.length,d=(e.len=m,e.squaredLength=s.squaredLength),M=(e.sqrLen=d,e.normalize=s.normalize);e.exactEquals=s.exactEquals,e.equals=s.equals,e.rotationTo=function(){var t=i.create(),e=i.fromValues(1,0,0),r=i.fromValues(0,1,0);return function(a,n,s){var o=i.dot(n,s);return o<-.999999?(i.cross(t,e,n),i.len(t)<1e-6&&i.cross(t,r,n),i.normalize(t,t),u(a,t,Math.PI),a):o>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(i.cross(t,n,s),a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=1+o,M(a,a))}}(),e.sqlerp=function(){var t=h(),e=h();return function(r,a,n,i,s,o){return l(t,a,s,o),l(e,n,i,o),l(r,t,e,2*o*(1-o)),r}}(),e.setAxes=function(){var t=n.create();return function(e,r,a,n){return t[0]=a[0],t[3]=a[1],t[6]=a[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],M(e,f(e,t))}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=function(){var t=new a.ARRAY_TYPE(16);return a.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.fromValues=function(t,e,r,n,i,s,o,h,u,c,l,f,m,d,M,v){var p=new a.ARRAY_TYPE(16);return p[0]=t,p[1]=e,p[2]=r,p[3]=n,p[4]=i,p[5]=s,p[6]=o,p[7]=h,p[8]=u,p[9]=c,p[10]=l,p[11]=f,p[12]=m,p[13]=d,p[14]=M,p[15]=v,p},e.set=function(t,e,r,a,n,i,s,o,h,u,c,l,f,m,d,M,v){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t[9]=c,t[10]=l,t[11]=f,t[12]=m,t[13]=d,t[14]=M,t[15]=v,t},e.identity=n,e.transpose=function(t,e){if(t===e){var r=e[1],a=e[2],n=e[3],i=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=i,t[11]=e[14],t[12]=n,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},e.invert=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],m=e[11],d=e[12],M=e[13],v=e[14],p=e[15],g=r*o-a*s,x=r*h-n*s,b=r*u-i*s,A=a*h-n*o,P=a*u-i*o,w=n*u-i*h,S=c*M-l*d,R=c*v-f*d,E=c*p-m*d,y=l*v-f*M,O=l*p-m*M,I=f*p-m*v,T=g*I-x*O+b*y+A*E-P*R+w*S;return T?(T=1/T,t[0]=(o*I-h*O+u*y)*T,t[1]=(n*O-a*I-i*y)*T,t[2]=(M*w-v*P+p*A)*T,t[3]=(f*P-l*w-m*A)*T,t[4]=(h*E-s*I-u*R)*T,t[5]=(r*I-n*E+i*R)*T,t[6]=(v*b-d*w-p*x)*T,t[7]=(c*w-f*b+m*x)*T,t[8]=(s*O-o*E+u*S)*T,t[9]=(a*E-r*O-i*S)*T,t[10]=(d*P-M*b+p*g)*T,t[11]=(l*b-c*P-m*g)*T,t[12]=(o*R-s*y-h*S)*T,t[13]=(r*y-a*R+n*S)*T,t[14]=(M*x-d*A-v*g)*T,t[15]=(c*A-l*x+f*g)*T,t):null},e.adjoint=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],m=e[11],d=e[12],M=e[13],v=e[14],p=e[15];return t[0]=o*(f*p-m*v)-l*(h*p-u*v)+M*(h*m-u*f),t[1]=-(a*(f*p-m*v)-l*(n*p-i*v)+M*(n*m-i*f)),t[2]=a*(h*p-u*v)-o*(n*p-i*v)+M*(n*u-i*h),t[3]=-(a*(h*m-u*f)-o*(n*m-i*f)+l*(n*u-i*h)),t[4]=-(s*(f*p-m*v)-c*(h*p-u*v)+d*(h*m-u*f)),t[5]=r*(f*p-m*v)-c*(n*p-i*v)+d*(n*m-i*f),t[6]=-(r*(h*p-u*v)-s*(n*p-i*v)+d*(n*u-i*h)),t[7]=r*(h*m-u*f)-s*(n*m-i*f)+c*(n*u-i*h),t[8]=s*(l*p-m*M)-c*(o*p-u*M)+d*(o*m-u*l),t[9]=-(r*(l*p-m*M)-c*(a*p-i*M)+d*(a*m-i*l)),t[10]=r*(o*p-u*M)-s*(a*p-i*M)+d*(a*u-i*o),t[11]=-(r*(o*m-u*l)-s*(a*m-i*l)+c*(a*u-i*o)),t[12]=-(s*(l*v-f*M)-c*(o*v-h*M)+d*(o*f-h*l)),t[13]=r*(l*v-f*M)-c*(a*v-n*M)+d*(a*f-n*l),t[14]=-(r*(o*v-h*M)-s*(a*v-n*M)+d*(a*h-n*o)),t[15]=r*(o*f-h*l)-s*(a*f-n*l)+c*(a*h-n*o),t},e.determinant=function(t){var e=t[0],r=t[1],a=t[2],n=t[3],i=t[4],s=t[5],o=t[6],h=t[7],u=t[8],c=t[9],l=t[10],f=t[11],m=t[12],d=t[13],M=t[14],v=t[15];return(e*s-r*i)*(l*v-f*M)-(e*o-a*i)*(c*v-f*d)+(e*h-n*i)*(c*M-l*d)+(r*o-a*s)*(u*v-f*m)-(r*h-n*s)*(u*M-l*m)+(a*h-n*o)*(u*d-c*m)},e.multiply=i,e.translate=function(t,e,r){var a=r[0],n=r[1],i=r[2],s=void 0,o=void 0,h=void 0,u=void 0,c=void 0,l=void 0,f=void 0,m=void 0,d=void 0,M=void 0,v=void 0,p=void 0;return e===t?(t[12]=e[0]*a+e[4]*n+e[8]*i+e[12],t[13]=e[1]*a+e[5]*n+e[9]*i+e[13],t[14]=e[2]*a+e[6]*n+e[10]*i+e[14],t[15]=e[3]*a+e[7]*n+e[11]*i+e[15]):(s=e[0],o=e[1],h=e[2],u=e[3],c=e[4],l=e[5],f=e[6],m=e[7],d=e[8],M=e[9],v=e[10],p=e[11],t[0]=s,t[1]=o,t[2]=h,t[3]=u,t[4]=c,t[5]=l,t[6]=f,t[7]=m,t[8]=d,t[9]=M,t[10]=v,t[11]=p,t[12]=s*a+c*n+d*i+e[12],t[13]=o*a+l*n+M*i+e[13],t[14]=h*a+f*n+v*i+e[14],t[15]=u*a+m*n+p*i+e[15]),t},e.scale=function(t,e,r){var a=r[0],n=r[1],i=r[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.rotate=function(t,e,r,n){var i,s,o,h,u,c,l,f,m,d,M,v,p,g,x,b,A,P,w,S,R,E,y,O,I=n[0],T=n[1],_=n[2],L=Math.sqrt(I*I+T*T+_*_);return L<a.EPSILON?null:(I*=L=1/L,T*=L,_*=L,i=Math.sin(r),o=1-(s=Math.cos(r)),h=e[0],u=e[1],c=e[2],l=e[3],f=e[4],m=e[5],d=e[6],M=e[7],v=e[8],p=e[9],g=e[10],x=e[11],b=I*I*o+s,A=T*I*o+_*i,P=_*I*o-T*i,w=I*T*o-_*i,S=T*T*o+s,R=_*T*o+I*i,E=I*_*o+T*i,y=T*_*o-I*i,O=_*_*o+s,t[0]=h*b+f*A+v*P,t[1]=u*b+m*A+p*P,t[2]=c*b+d*A+g*P,t[3]=l*b+M*A+x*P,t[4]=h*w+f*S+v*R,t[5]=u*w+m*S+p*R,t[6]=c*w+d*S+g*R,t[7]=l*w+M*S+x*R,t[8]=h*E+f*y+v*O,t[9]=u*E+m*y+p*O,t[10]=c*E+d*y+g*O,t[11]=l*E+M*y+x*O,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},e.rotateX=function(t,e,r){var a=Math.sin(r),n=Math.cos(r),i=e[4],s=e[5],o=e[6],h=e[7],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*n+u*a,t[5]=s*n+c*a,t[6]=o*n+l*a,t[7]=h*n+f*a,t[8]=u*n-i*a,t[9]=c*n-s*a,t[10]=l*n-o*a,t[11]=f*n-h*a,t},e.rotateY=function(t,e,r){var a=Math.sin(r),n=Math.cos(r),i=e[0],s=e[1],o=e[2],h=e[3],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*n-u*a,t[1]=s*n-c*a,t[2]=o*n-l*a,t[3]=h*n-f*a,t[8]=i*a+u*n,t[9]=s*a+c*n,t[10]=o*a+l*n,t[11]=h*a+f*n,t},e.rotateZ=function(t,e,r){var a=Math.sin(r),n=Math.cos(r),i=e[0],s=e[1],o=e[2],h=e[3],u=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*n+u*a,t[1]=s*n+c*a,t[2]=o*n+l*a,t[3]=h*n+f*a,t[4]=u*n-i*a,t[5]=c*n-s*a,t[6]=l*n-o*a,t[7]=f*n-h*a,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotation=function(t,e,r){var n,i,s,o=r[0],h=r[1],u=r[2],c=Math.sqrt(o*o+h*h+u*u);return c<a.EPSILON?null:(o*=c=1/c,h*=c,u*=c,n=Math.sin(e),s=1-(i=Math.cos(e)),t[0]=o*o*s+i,t[1]=h*o*s+u*n,t[2]=u*o*s-h*n,t[3]=0,t[4]=o*h*s-u*n,t[5]=h*h*s+i,t[6]=u*h*s+o*n,t[7]=0,t[8]=o*u*s+h*n,t[9]=h*u*s-o*n,t[10]=u*u*s+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},e.fromXRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromYRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromZRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotationTranslation=s,e.fromQuat2=function(t,e){var r=new a.ARRAY_TYPE(3),n=-e[0],i=-e[1],o=-e[2],h=e[3],u=e[4],c=e[5],l=e[6],f=e[7],m=n*n+i*i+o*o+h*h;return m>0?(r[0]=2*(u*h+f*n+c*o-l*i)/m,r[1]=2*(c*h+f*i+l*n-u*o)/m,r[2]=2*(l*h+f*o+u*i-c*n)/m):(r[0]=2*(u*h+f*n+c*o-l*i),r[1]=2*(c*h+f*i+l*n-u*o),r[2]=2*(l*h+f*o+u*i-c*n)),s(t,e,r),t},e.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},e.getScaling=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[4],s=e[5],o=e[6],h=e[8],u=e[9],c=e[10];return t[0]=Math.sqrt(r*r+a*a+n*n),t[1]=Math.sqrt(i*i+s*s+o*o),t[2]=Math.sqrt(h*h+u*u+c*c),t},e.getRotation=function(t,e){var r=e[0]+e[5]+e[10],a=0;return r>0?(a=2*Math.sqrt(r+1),t[3]=.25*a,t[0]=(e[6]-e[9])/a,t[1]=(e[8]-e[2])/a,t[2]=(e[1]-e[4])/a):e[0]>e[5]&&e[0]>e[10]?(a=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/a,t[0]=.25*a,t[1]=(e[1]+e[4])/a,t[2]=(e[8]+e[2])/a):e[5]>e[10]?(a=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/a,t[0]=(e[1]+e[4])/a,t[1]=.25*a,t[2]=(e[6]+e[9])/a):(a=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/a,t[0]=(e[8]+e[2])/a,t[1]=(e[6]+e[9])/a,t[2]=.25*a),t},e.fromRotationTranslationScale=function(t,e,r,a){var n=e[0],i=e[1],s=e[2],o=e[3],h=n+n,u=i+i,c=s+s,l=n*h,f=n*u,m=n*c,d=i*u,M=i*c,v=s*c,p=o*h,g=o*u,x=o*c,b=a[0],A=a[1],P=a[2];return t[0]=(1-(d+v))*b,t[1]=(f+x)*b,t[2]=(m-g)*b,t[3]=0,t[4]=(f-x)*A,t[5]=(1-(l+v))*A,t[6]=(M+p)*A,t[7]=0,t[8]=(m+g)*P,t[9]=(M-p)*P,t[10]=(1-(l+d))*P,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},e.fromRotationTranslationScaleOrigin=function(t,e,r,a,n){var i=e[0],s=e[1],o=e[2],h=e[3],u=i+i,c=s+s,l=o+o,f=i*u,m=i*c,d=i*l,M=s*c,v=s*l,p=o*l,g=h*u,x=h*c,b=h*l,A=a[0],P=a[1],w=a[2],S=n[0],R=n[1],E=n[2],y=(1-(M+p))*A,O=(m+b)*A,I=(d-x)*A,T=(m-b)*P,_=(1-(f+p))*P,L=(v+g)*P,D=(d+x)*w,N=(v-g)*w,z=(1-(f+M))*w;return t[0]=y,t[1]=O,t[2]=I,t[3]=0,t[4]=T,t[5]=_,t[6]=L,t[7]=0,t[8]=D,t[9]=N,t[10]=z,t[11]=0,t[12]=r[0]+S-(y*S+T*R+D*E),t[13]=r[1]+R-(O*S+_*R+N*E),t[14]=r[2]+E-(I*S+L*R+z*E),t[15]=1,t},e.fromQuat=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r+r,o=a+a,h=n+n,u=r*s,c=a*s,l=a*o,f=n*s,m=n*o,d=n*h,M=i*s,v=i*o,p=i*h;return t[0]=1-l-d,t[1]=c+p,t[2]=f-v,t[3]=0,t[4]=c-p,t[5]=1-u-d,t[6]=m+M,t[7]=0,t[8]=f+v,t[9]=m-M,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.frustum=function(t,e,r,a,n,i,s){var o=1/(r-e),h=1/(n-a),u=1/(i-s);return t[0]=2*i*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*h,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(n+a)*h,t[10]=(s+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*i*2*u,t[15]=0,t},e.perspective=function(t,e,r,a,n){var i=1/Math.tan(e/2),s=void 0;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(s=1/(a-n),t[10]=(n+a)*s,t[14]=2*n*a*s):(t[10]=-1,t[14]=-2*a),t},e.perspectiveFromFieldOfView=function(t,e,r,a){var n=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+o),u=2/(n+i);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(s-o)*h*.5,t[9]=(n-i)*u*.5,t[10]=a/(r-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*r/(r-a),t[15]=0,t},e.ortho=function(t,e,r,a,n,i,s){var o=1/(e-r),h=1/(a-n),u=1/(i-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(n+a)*h,t[14]=(s+i)*u,t[15]=1,t},e.lookAt=function(t,e,r,i){var s=void 0,o=void 0,h=void 0,u=void 0,c=void 0,l=void 0,f=void 0,m=void 0,d=void 0,M=void 0,v=e[0],p=e[1],g=e[2],x=i[0],b=i[1],A=i[2],P=r[0],w=r[1],S=r[2];return Math.abs(v-P)<a.EPSILON&&Math.abs(p-w)<a.EPSILON&&Math.abs(g-S)<a.EPSILON?n(t):(f=v-P,m=p-w,d=g-S,s=b*(d*=M=1/Math.sqrt(f*f+m*m+d*d))-A*(m*=M),o=A*(f*=M)-x*d,h=x*m-b*f,(M=Math.sqrt(s*s+o*o+h*h))?(s*=M=1/M,o*=M,h*=M):(s=0,o=0,h=0),u=m*h-d*o,c=d*s-f*h,l=f*o-m*s,(M=Math.sqrt(u*u+c*c+l*l))?(u*=M=1/M,c*=M,l*=M):(u=0,c=0,l=0),t[0]=s,t[1]=u,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=m,t[7]=0,t[8]=h,t[9]=l,t[10]=d,t[11]=0,t[12]=-(s*v+o*p+h*g),t[13]=-(u*v+c*p+l*g),t[14]=-(f*v+m*p+d*g),t[15]=1,t)},e.targetTo=function(t,e,r,a){var n=e[0],i=e[1],s=e[2],o=a[0],h=a[1],u=a[2],c=n-r[0],l=i-r[1],f=s-r[2],m=c*c+l*l+f*f;m>0&&(c*=m=1/Math.sqrt(m),l*=m,f*=m);var d=h*f-u*l,M=u*c-o*f,v=o*l-h*c;return(m=d*d+M*M+v*v)>0&&(d*=m=1/Math.sqrt(m),M*=m,v*=m),t[0]=d,t[1]=M,t[2]=v,t[3]=0,t[4]=l*v-f*M,t[5]=f*d-c*v,t[6]=c*M-l*d,t[7]=0,t[8]=c,t[9]=l,t[10]=f,t[11]=0,t[12]=n,t[13]=i,t[14]=s,t[15]=1,t},e.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},e.subtract=o,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},e.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t[9]=e[9]+r[9]*a,t[10]=e[10]+r[10]*a,t[11]=e[11]+r[11]*a,t[12]=e[12]+r[12]*a,t[13]=e[13]+r[13]*a,t[14]=e[14]+r[14]*a,t[15]=e[15]+r[15]*a,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],f=t[9],m=t[10],d=t[11],M=t[12],v=t[13],p=t[14],g=t[15],x=e[0],b=e[1],A=e[2],P=e[3],w=e[4],S=e[5],R=e[6],E=e[7],y=e[8],O=e[9],I=e[10],T=e[11],_=e[12],L=e[13],D=e[14],N=e[15];return Math.abs(r-x)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(n-b)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-A)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(s-P)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(o-w)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(h-S)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(u-R)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(c-E)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(l-y)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(f-O)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(m-I)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(d-T)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(M-_)<=a.EPSILON*Math.max(1,Math.abs(M),Math.abs(_))&&Math.abs(v-L)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(p-D)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(g-N)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))};var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function n(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=e[9],m=e[10],d=e[11],M=e[12],v=e[13],p=e[14],g=e[15],x=r[0],b=r[1],A=r[2],P=r[3];return t[0]=x*a+b*o+A*l+P*M,t[1]=x*n+b*h+A*f+P*v,t[2]=x*i+b*u+A*m+P*p,t[3]=x*s+b*c+A*d+P*g,x=r[4],b=r[5],A=r[6],P=r[7],t[4]=x*a+b*o+A*l+P*M,t[5]=x*n+b*h+A*f+P*v,t[6]=x*i+b*u+A*m+P*p,t[7]=x*s+b*c+A*d+P*g,x=r[8],b=r[9],A=r[10],P=r[11],t[8]=x*a+b*o+A*l+P*M,t[9]=x*n+b*h+A*f+P*v,t[10]=x*i+b*u+A*m+P*p,t[11]=x*s+b*c+A*d+P*g,x=r[12],b=r[13],A=r[14],P=r[15],t[12]=x*a+b*o+A*l+P*M,t[13]=x*n+b*h+A*f+P*v,t[14]=x*i+b*u+A*m+P*p,t[15]=x*s+b*c+A*d+P*g,t}function s(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=a+a,h=n+n,u=i+i,c=a*o,l=a*h,f=a*u,m=n*h,d=n*u,M=i*u,v=s*o,p=s*h,g=s*u;return t[0]=1-(m+M),t[1]=l+g,t[2]=f-p,t[3]=0,t[4]=l-g,t[5]=1-(c+M),t[6]=d+v,t[7]=0,t[8]=f+p,t[9]=d-v,t[10]=1-(c+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}e.mul=i,e.sub=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=function(){var t=new a.ARRAY_TYPE(9);return a.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},e.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},e.clone=function(t){var e=new a.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromValues=function(t,e,r,n,i,s,o,h,u){var c=new a.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=i,c[5]=s,c[6]=o,c[7]=h,c[8]=u,c},e.set=function(t,e,r,a,n,i,s,o,h,u){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.transpose=function(t,e){if(t===e){var r=e[1],a=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=a,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},e.invert=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=c*s-o*u,f=-c*i+o*h,m=u*i-s*h,d=r*l+a*f+n*m;return d?(d=1/d,t[0]=l*d,t[1]=(-c*a+n*u)*d,t[2]=(o*a-n*s)*d,t[3]=f*d,t[4]=(c*r-n*h)*d,t[5]=(-o*r+n*i)*d,t[6]=m*d,t[7]=(-u*r+a*h)*d,t[8]=(s*r-a*i)*d,t):null},e.adjoint=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8];return t[0]=s*c-o*u,t[1]=n*u-a*c,t[2]=a*o-n*s,t[3]=o*h-i*c,t[4]=r*c-n*h,t[5]=n*i-r*o,t[6]=i*u-s*h,t[7]=a*h-r*u,t[8]=r*s-a*i,t},e.determinant=function(t){var e=t[0],r=t[1],a=t[2],n=t[3],i=t[4],s=t[5],o=t[6],h=t[7],u=t[8];return e*(u*i-s*h)+r*(-u*n+s*o)+a*(h*n-i*o)},e.multiply=n,e.translate=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=r[0],m=r[1];return t[0]=a,t[1]=n,t[2]=i,t[3]=s,t[4]=o,t[5]=h,t[6]=f*a+m*s+u,t[7]=f*n+m*o+c,t[8]=f*i+m*h+l,t},e.rotate=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=Math.sin(r),m=Math.cos(r);return t[0]=m*a+f*s,t[1]=m*n+f*o,t[2]=m*i+f*h,t[3]=m*s-f*a,t[4]=m*o-f*n,t[5]=m*h-f*i,t[6]=u,t[7]=c,t[8]=l,t},e.scale=function(t,e,r){var a=r[0],n=r[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},e.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=-r,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},e.fromQuat=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r+r,o=a+a,h=n+n,u=r*s,c=a*s,l=a*o,f=n*s,m=n*o,d=n*h,M=i*s,v=i*o,p=i*h;return t[0]=1-l-d,t[3]=c-p,t[6]=f+v,t[1]=c+p,t[4]=1-u-d,t[7]=m-M,t[2]=f-v,t[5]=m+M,t[8]=1-u-l,t},e.normalFromMat4=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],m=e[11],d=e[12],M=e[13],v=e[14],p=e[15],g=r*o-a*s,x=r*h-n*s,b=r*u-i*s,A=a*h-n*o,P=a*u-i*o,w=n*u-i*h,S=c*M-l*d,R=c*v-f*d,E=c*p-m*d,y=l*v-f*M,O=l*p-m*M,I=f*p-m*v,T=g*I-x*O+b*y+A*E-P*R+w*S;return T?(T=1/T,t[0]=(o*I-h*O+u*y)*T,t[1]=(h*E-s*I-u*R)*T,t[2]=(s*O-o*E+u*S)*T,t[3]=(n*O-a*I-i*y)*T,t[4]=(r*I-n*E+i*R)*T,t[5]=(a*E-r*O-i*S)*T,t[6]=(M*w-v*P+p*A)*T,t[7]=(v*b-d*w-p*x)*T,t[8]=(d*P-M*b+p*g)*T,t):null},e.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},e.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},e.subtract=i,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},e.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],f=e[0],m=e[1],d=e[2],M=e[3],v=e[4],p=e[5],g=e[6],x=e[7],b=e[8];return Math.abs(r-f)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-m)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(i-d)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-M)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(o-v)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(h-p)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(p))&&Math.abs(u-g)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(c-x)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(l-b)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))};var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function n(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=r[0],m=r[1],d=r[2],M=r[3],v=r[4],p=r[5],g=r[6],x=r[7],b=r[8];return t[0]=f*a+m*s+d*u,t[1]=f*n+m*o+d*c,t[2]=f*i+m*h+d*l,t[3]=M*a+v*s+p*u,t[4]=M*n+v*o+p*c,t[5]=M*i+v*h+p*l,t[6]=g*a+x*s+b*u,t[7]=g*n+x*o+b*c,t[8]=g*i+x*h+b*l,t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}e.mul=n,e.sub=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.sqrDist=e.dist=e.div=e.mul=e.sub=e.len=void 0,e.create=n,e.clone=function(t){var e=new a.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var r=new a.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,r){return t[0]=e,t[1]=r,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},e.subtract=i,e.multiply=s,e.divide=o,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},e.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t},e.distance=h,e.squaredDistance=u,e.length=c,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},e.normalize=function(t,e){var r=e[0],a=e[1],n=r*r+a*a;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,r){var a=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=a,t},e.lerp=function(t,e,r,a){var n=e[0],i=e[1];return t[0]=n+a*(r[0]-n),t[1]=i+a*(r[1]-i),t},e.random=function(t,e){e=e||1;var r=2*a.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},e.transformMat2=function(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[2]*n,t[1]=r[1]*a+r[3]*n,t},e.transformMat2d=function(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[2]*n+r[4],t[1]=r[1]*a+r[3]*n+r[5],t},e.transformMat3=function(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[3]*n+r[6],t[1]=r[1]*a+r[4]*n+r[7],t},e.transformMat4=function(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[4]*n+r[12],t[1]=r[1]*a+r[5]*n+r[13],t},e.rotate=function(t,e,r,a){var n=e[0]-r[0],i=e[1]-r[1],s=Math.sin(a),o=Math.cos(a);return t[0]=n*o-i*s+r[0],t[1]=n*s+i*o+r[1],t},e.angle=function(t,e){var r=t[0],a=t[1],n=e[0],i=e[1],s=r*r+a*a;s>0&&(s=1/Math.sqrt(s));var o=n*n+i*i;o>0&&(o=1/Math.sqrt(o));var h=(r*n+a*i)*s*o;return h>1?0:h<-1?Math.PI:Math.acos(h)},e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},e.equals=function(t,e){var r=t[0],n=t[1],i=e[0],s=e[1];return Math.abs(r-i)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))};var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function n(){var t=new a.ARRAY_TYPE(2);return a.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function s(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function o(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function h(t,e){var r=e[0]-t[0],a=e[1]-t[1];return Math.sqrt(r*r+a*a)}function u(t,e){var r=e[0]-t[0],a=e[1]-t[1];return r*r+a*a}function c(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function l(t){var e=t[0],r=t[1];return e*e+r*r}e.len=c,e.sub=i,e.mul=s,e.div=o,e.dist=h,e.sqrDist=u,e.sqrLen=l,e.forEach=function(){var t=n();return function(e,r,a,n,i,s){var o,h=void 0;for(r||(r=2),a||(a=0),o=n?Math.min(n*r+a,e.length):e.length,h=a;h<o;h+=r)t[0]=e[h],t[1]=e[h+1],i(t,t,s),e[h]=t[0],e[h+1]=t[1];return e}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sqrLen=e.squaredLength=e.len=e.length=e.dot=e.mul=e.setReal=e.getReal=void 0,e.create=function(){var t=new a.ARRAY_TYPE(8);return a.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},e.fromValues=function(t,e,r,n,i,s,o,h){var u=new a.ARRAY_TYPE(8);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=i,u[5]=s,u[6]=o,u[7]=h,u},e.fromRotationTranslationValues=function(t,e,r,n,i,s,o){var h=new a.ARRAY_TYPE(8);h[0]=t,h[1]=e,h[2]=r,h[3]=n;var u=.5*i,c=.5*s,l=.5*o;return h[4]=u*n+c*r-l*e,h[5]=c*n+l*t-u*r,h[6]=l*n+u*e-c*t,h[7]=-u*t-c*e-l*r,h},e.fromRotationTranslation=o,e.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},e.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.fromMat4=function(t,e){var r=n.create();i.getRotation(r,e);var s=new a.ARRAY_TYPE(3);return i.getTranslation(s,e),o(t,r,s),t},e.copy=h,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.set=function(t,e,r,a,n,i,s,o,h){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=s,t[6]=o,t[7]=h,t},e.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},e.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},e.getTranslation=function(t,e){var r=e[4],a=e[5],n=e[6],i=e[7],s=-e[0],o=-e[1],h=-e[2],u=e[3];return t[0]=2*(r*u+i*s+a*h-n*o),t[1]=2*(a*u+i*o+n*s-r*h),t[2]=2*(n*u+i*h+r*o-a*s),t},e.translate=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=.5*r[0],h=.5*r[1],u=.5*r[2],c=e[4],l=e[5],f=e[6],m=e[7];return t[0]=a,t[1]=n,t[2]=i,t[3]=s,t[4]=s*o+n*u-i*h+c,t[5]=s*h+i*o-a*u+l,t[6]=s*u+a*h-n*o+f,t[7]=-a*o-n*h-i*u+m,t},e.rotateX=function(t,e,r){var a=-e[0],i=-e[1],s=-e[2],o=e[3],h=e[4],u=e[5],c=e[6],l=e[7],f=h*o+l*a+u*s-c*i,m=u*o+l*i+c*a-h*s,d=c*o+l*s+h*i-u*a,M=l*o-h*a-u*i-c*s;return n.rotateX(t,e,r),a=t[0],i=t[1],s=t[2],o=t[3],t[4]=f*o+M*a+m*s-d*i,t[5]=m*o+M*i+d*a-f*s,t[6]=d*o+M*s+f*i-m*a,t[7]=M*o-f*a-m*i-d*s,t},e.rotateY=function(t,e,r){var a=-e[0],i=-e[1],s=-e[2],o=e[3],h=e[4],u=e[5],c=e[6],l=e[7],f=h*o+l*a+u*s-c*i,m=u*o+l*i+c*a-h*s,d=c*o+l*s+h*i-u*a,M=l*o-h*a-u*i-c*s;return n.rotateY(t,e,r),a=t[0],i=t[1],s=t[2],o=t[3],t[4]=f*o+M*a+m*s-d*i,t[5]=m*o+M*i+d*a-f*s,t[6]=d*o+M*s+f*i-m*a,t[7]=M*o-f*a-m*i-d*s,t},e.rotateZ=function(t,e,r){var a=-e[0],i=-e[1],s=-e[2],o=e[3],h=e[4],u=e[5],c=e[6],l=e[7],f=h*o+l*a+u*s-c*i,m=u*o+l*i+c*a-h*s,d=c*o+l*s+h*i-u*a,M=l*o-h*a-u*i-c*s;return n.rotateZ(t,e,r),a=t[0],i=t[1],s=t[2],o=t[3],t[4]=f*o+M*a+m*s-d*i,t[5]=m*o+M*i+d*a-f*s,t[6]=d*o+M*s+f*i-m*a,t[7]=M*o-f*a-m*i-d*s,t},e.rotateByQuatAppend=function(t,e,r){var a=r[0],n=r[1],i=r[2],s=r[3],o=e[0],h=e[1],u=e[2],c=e[3];return t[0]=o*s+c*a+h*i-u*n,t[1]=h*s+c*n+u*a-o*i,t[2]=u*s+c*i+o*n-h*a,t[3]=c*s-o*a-h*n-u*i,o=e[4],h=e[5],u=e[6],c=e[7],t[4]=o*s+c*a+h*i-u*n,t[5]=h*s+c*n+u*a-o*i,t[6]=u*s+c*i+o*n-h*a,t[7]=c*s-o*a-h*n-u*i,t},e.rotateByQuatPrepend=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[0],h=r[1],u=r[2],c=r[3];return t[0]=a*c+s*o+n*u-i*h,t[1]=n*c+s*h+i*o-a*u,t[2]=i*c+s*u+a*h-n*o,t[3]=s*c-a*o-n*h-i*u,o=r[4],h=r[5],u=r[6],c=r[7],t[4]=a*c+s*o+n*u-i*h,t[5]=n*c+s*h+i*o-a*u,t[6]=i*c+s*u+a*h-n*o,t[7]=s*c-a*o-n*h-i*u,t},e.rotateAroundAxis=function(t,e,r,n){if(Math.abs(n)<a.EPSILON)return h(t,e);var i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);n*=.5;var s=Math.sin(n),o=s*r[0]/i,u=s*r[1]/i,c=s*r[2]/i,l=Math.cos(n),f=e[0],m=e[1],d=e[2],M=e[3];t[0]=f*l+M*o+m*c-d*u,t[1]=m*l+M*u+d*o-f*c,t[2]=d*l+M*c+f*u-m*o,t[3]=M*l-f*o-m*u-d*c;var v=e[4],p=e[5],g=e[6],x=e[7];return t[4]=v*l+x*o+p*c-g*u,t[5]=p*l+x*u+g*o-v*c,t[6]=g*l+x*c+v*u-p*o,t[7]=x*l-v*o-p*u-g*c,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},e.multiply=u,e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},e.lerp=function(t,e,r,a){var n=1-a;return c(e,r)<0&&(a=-a),t[0]=e[0]*n+r[0]*a,t[1]=e[1]*n+r[1]*a,t[2]=e[2]*n+r[2]*a,t[3]=e[3]*n+r[3]*a,t[4]=e[4]*n+r[4]*a,t[5]=e[5]*n+r[5]*a,t[6]=e[6]*n+r[6]*a,t[7]=e[7]*n+r[7]*a,t},e.invert=function(t,e){var r=f(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},e.normalize=function(t,e){var r=f(e);if(r>0){r=Math.sqrt(r);var a=e[0]/r,n=e[1]/r,i=e[2]/r,s=e[3]/r,o=e[4],h=e[5],u=e[6],c=e[7],l=a*o+n*h+i*u+s*c;t[0]=a,t[1]=n,t[2]=i,t[3]=s,t[4]=(o-a*l)/r,t[5]=(h-n*l)/r,t[6]=(u-i*l)/r,t[7]=(c-s*l)/r}return t},e.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=e[0],f=e[1],m=e[2],d=e[3],M=e[4],v=e[5],p=e[6],g=e[7];return Math.abs(r-l)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-f)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-m)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(s-d)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-M)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(h-v)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(u-p)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))&&Math.abs(c-g)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))};var a=s(r(0)),n=s(r(3)),i=s(r(4));function s(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function o(t,e,r){var a=.5*r[0],n=.5*r[1],i=.5*r[2],s=e[0],o=e[1],h=e[2],u=e[3];return t[0]=s,t[1]=o,t[2]=h,t[3]=u,t[4]=a*u+n*h-i*o,t[5]=n*u+i*s-a*h,t[6]=i*u+a*o-n*s,t[7]=-a*s-n*o-i*h,t}function h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function u(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[4],h=r[5],u=r[6],c=r[7],l=e[4],f=e[5],m=e[6],d=e[7],M=r[0],v=r[1],p=r[2],g=r[3];return t[0]=a*g+s*M+n*p-i*v,t[1]=n*g+s*v+i*M-a*p,t[2]=i*g+s*p+a*v-n*M,t[3]=s*g-a*M-n*v-i*p,t[4]=a*c+s*o+n*u-i*h+l*g+d*M+f*p-m*v,t[5]=n*c+s*h+i*o-a*u+f*g+d*v+m*M-l*p,t[6]=i*c+s*u+a*h-n*o+m*g+d*p+l*v-f*M,t[7]=s*c-a*o-n*h-i*u+d*g-l*M-f*v-m*p,t}e.getReal=n.copy,e.setReal=n.copy,e.mul=u;var c=e.dot=n.dot,l=e.length=n.length,f=(e.len=l,e.squaredLength=n.squaredLength);e.sqrLen=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=function(){var t=new a.ARRAY_TYPE(6);return a.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},e.fromValues=function(t,e,r,n,i,s){var o=new a.ARRAY_TYPE(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=n,o[4]=i,o[5]=s,o},e.set=function(t,e,r,a,n,i,s){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=i,t[5]=s,t},e.invert=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=e[4],o=e[5],h=r*i-a*n;return h?(h=1/h,t[0]=i*h,t[1]=-a*h,t[2]=-n*h,t[3]=r*h,t[4]=(n*o-i*s)*h,t[5]=(a*s-r*o)*h,t):null},e.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},e.multiply=n,e.rotate=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],h=e[5],u=Math.sin(r),c=Math.cos(r);return t[0]=a*c+i*u,t[1]=n*c+s*u,t[2]=a*-u+i*c,t[3]=n*-u+s*c,t[4]=o,t[5]=h,t},e.scale=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],h=e[5],u=r[0],c=r[1];return t[0]=a*u,t[1]=n*u,t[2]=i*c,t[3]=s*c,t[4]=o,t[5]=h,t},e.translate=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],h=e[5],u=r[0],c=r[1];return t[0]=a,t[1]=n,t[2]=i,t[3]=s,t[4]=a*u+i*c+o,t[5]=n*u+s*c+h,t},e.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=-r,t[3]=a,t[4]=0,t[5]=0,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},e.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},e.subtract=i,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},e.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],h=t[5],u=e[0],c=e[1],l=e[2],f=e[3],m=e[4],d=e[5];return Math.abs(r-u)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-c)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-l)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-f)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-m)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(h-d)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(d))};var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function n(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=e[4],h=e[5],u=r[0],c=r[1],l=r[2],f=r[3],m=r[4],d=r[5];return t[0]=a*u+i*c,t[1]=n*u+s*c,t[2]=a*l+i*f,t[3]=n*l+s*f,t[4]=a*m+i*d+o,t[5]=n*m+s*d+h,t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}e.mul=n,e.sub=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=function(){var t=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},e.fromValues=function(t,e,r,n){var i=new a.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i},e.set=function(t,e,r,a,n){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t},e.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},e.invert=function(t,e){var r=e[0],a=e[1],n=e[2],i=e[3],s=r*i-n*a;return s?(s=1/s,t[0]=i*s,t[1]=-a*s,t[2]=-n*s,t[3]=r*s,t):null},e.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},e.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},e.multiply=n,e.rotate=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=a*h+i*o,t[1]=n*h+s*o,t[2]=a*-o+i*h,t[3]=n*-o+s*h,t},e.scale=function(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[0],h=r[1];return t[0]=a*o,t[1]=n*o,t[2]=i*h,t[3]=s*h,t},e.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=-r,t[3]=a,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},e.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},e.LDU=function(t,e,r,a){return t[2]=a[2]/a[0],r[0]=a[0],r[1]=a[1],r[3]=a[3]-t[2]*r[1],[t,e,r]},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},e.subtract=i,e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],o=e[0],h=e[1],u=e[2],c=e[3];return Math.abs(r-o)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-h)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-u)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-c)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},e.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t};var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function n(t,e,r){var a=e[0],n=e[1],i=e[2],s=e[3],o=r[0],h=r[1],u=r[2],c=r[3];return t[0]=a*o+i*h,t[1]=n*o+s*h,t[2]=a*u+i*c,t[3]=n*u+s*c,t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}e.mul=n,e.sub=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0;var a=m(r(0)),n=m(r(9)),i=m(r(8)),s=m(r(5)),o=m(r(4)),h=m(r(3)),u=m(r(7)),c=m(r(6)),l=m(r(2)),f=m(r(1));function m(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}e.glMatrix=a,e.mat2=n,e.mat2d=i,e.mat3=s,e.mat4=o,e.quat=h,e.quat2=u,e.vec2=c,e.vec3=l,e.vec4=f}])});let Zoom,Zoom0,pixel=.75,BezierFactor=.4,FillFactor=.1,maxViewportWidth=window.innerWidth,maxViewportHeight=window.innerHeight;const zoomStep=.1,resizeStep=1.2,zoomFactor=1.05,zoomPinchFactor=10,zoomPinchCap=100,shiftHoldDistance=20,shiftWaitTime=200,vibrateTime=25;let lastzoom,H,zmin,zmax,size2,b,B,positionBuffer,materialBuffer,colorBuffer,indexBuffer,Fuzz2=1e3*Number.EPSILON,Fuzz4=Fuzz2*Fuzz2,third=1/3,P=[],Materials=[],Lights=[],Centers=[],devicepixels=!1,rotMat=mat4.create(),projMat=mat4.create(),viewMat=mat4.create(),projViewMat=mat4.create(),normMat=mat3.create(),viewMat3=mat3.create(),rotMats=mat4.create(),cjMatInv=mat4.create(),translMat=mat4.create(),center={x:0,y:0,z:0},shift={x:0,y:0},viewParam={xmin:0,xmax:0,ymin:0,ymax:0,zmin:0,zmax:0},redraw=!0,remesh=!0,mouseDownOrTouchActive=!1,lastMouseX=null,lastMouseY=null,touchID=null,Positions=[],Normals=[],Colors=[],Indices=[];class Material{constructor(t,e,r,a,n,i){this.diffuse=t,this.emissive=e,this.specular=r,this.shininess=a,this.metallic=n,this.fresnel0=i}setUniform(t,e,r=null){let a;a=null===r?r=>gl.getUniformLocation(t,e+"."+r):a=>gl.getUniformLocation(t,e+"["+r+"]."+a),gl.uniform4fv(a("diffuse"),new Float32Array(this.diffuse)),gl.uniform4fv(a("emissive"),new Float32Array(this.emissive)),gl.uniform4fv(a("specular"),new Float32Array(this.specular)),gl.uniform1f(a("shininess"),this.shininess),gl.uniform1f(a("metallic"),this.metallic),gl.uniform1f(a("fresnel0"),this.fresnel0)}}let enumPointLight=1,enumDirectionalLight=2;class Light{constructor(t,e){this.direction=t,this.color=e}setUniform(t,e,r){let a=a=>gl.getUniformLocation(t,e+"["+r+"]."+a);gl.uniform3fv(a("direction"),new Float32Array(this.direction)),gl.uniform3fv(a("color"),new Float32Array(this.color))}}function initGL(){try{gl=canvas.getContext("webgl",{alpha:!1})}catch(t){}gl||alert("Could not initialize WebGL")}function getShader(t,e,r=[]){let a=document.getElementById(e);if(!a)return null;let n=`#version 100\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n  const int nLights=${Lights.length};\n  const int nMaterials=${Materials.length};\n`;orthographic&&(n+="#define ORTHOGRAPHIC\n"),r.forEach(t=>n+="#define "+t+"\n");let i,s=a.firstChild;for(;s;)3==s.nodeType&&(n+=s.textContent),s=s.nextSibling;if("x-shader/x-fragment"==a.type)i=t.createShader(t.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!=a.type)return null;i=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(alert(t.getShaderInfoLog(i)),null)}function drawBuffer(t,e,r=t.indices){if(0==t.indices.length)return;let a=e==pixelShader,n=!a&&e!=noNormalShader;setUniforms(e),gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t.vertices),gl.STATIC_DRAW),gl.vertexAttribPointer(e.vertexPositionAttribute,3,gl.FLOAT,!1,n?24:a?16:12,0),n?gl.vertexAttribPointer(e.vertexNormalAttribute,3,gl.FLOAT,!1,24,12):a&&gl.vertexAttribPointer(e.vertexWidthAttribute,1,gl.FLOAT,!1,16,12),gl.bindBuffer(gl.ARRAY_BUFFER,materialBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Int16Array(t.materials),gl.STATIC_DRAW),gl.vertexAttribPointer(e.vertexMaterialAttribute,1,gl.SHORT,!1,2,0),e!=colorShader&&e!=transparentShader||(gl.bindBuffer(gl.ARRAY_BUFFER,colorBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Uint8Array(t.colors),gl.STATIC_DRAW),gl.vertexAttribPointer(e.vertexColorAttribute,4,gl.UNSIGNED_BYTE,!0,0,0)),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,indexExt?new Uint32Array(r):new Uint16Array(r),gl.STATIC_DRAW),gl.drawElements(n?gl.TRIANGLES:a?gl.POINTS:gl.LINES,r.length,indexExt?gl.UNSIGNED_INT:gl.UNSIGNED_SHORT,0)}class vertexBuffer{constructor(){this.clear()}clear(){this.vertices=[],this.materials=[],this.colors=[],this.indices=[],this.nvertices=0}vertex(t,e){return this.vertices.push(t[0]),this.vertices.push(t[1]),this.vertices.push(t[2]),this.vertices.push(e[0]),this.vertices.push(e[1]),this.vertices.push(e[2]),this.materials.push(materialIndex),this.nvertices++}Vertex(t,e,r=[0,0,0,0]){return this.vertices.push(t[0]),this.vertices.push(t[1]),this.vertices.push(t[2]),this.vertices.push(e[0]),this.vertices.push(e[1]),this.vertices.push(e[2]),this.materials.push(materialIndex),this.colors.push(r[0]),this.colors.push(r[1]),this.colors.push(r[2]),this.colors.push(r[3]),this.nvertices++}vertex1(t){return this.vertices.push(t[0]),this.vertices.push(t[1]),this.vertices.push(t[2]),this.materials.push(materialIndex),this.nvertices++}vertex0(t,e){return this.vertices.push(t[0]),this.vertices.push(t[1]),this.vertices.push(t[2]),this.vertices.push(e),this.materials.push(materialIndex),this.nvertices++}iVertex(t,e,r,a=[0,0,0,0]){let n=6*t;this.vertices[n]=e[0],this.vertices[n+1]=e[1],this.vertices[n+2]=e[2],this.vertices[n+3]=r[0],this.vertices[n+4]=r[1],this.vertices[n+5]=r[2],this.materials[t]=materialIndex;let i=4*t;this.colors[i]=a[0],this.colors[i+1]=a[1],this.colors[i+2]=a[2],this.colors[i+3]=a[3],this.indices.push(t)}append(t){append(this.vertices,t.vertices),append(this.materials,t.materials),append(this.colors,t.colors),appendOffset(this.indices,t.indices,this.nvertices),this.nvertices+=t.nvertices}}let materialIndex,material0Data=new vertexBuffer,material1Data=new vertexBuffer,materialData=new vertexBuffer,colorData=new vertexBuffer,transparentData=new vertexBuffer,triangleData=new vertexBuffer;function append(t,e){let r=t.length,a=e.length;t.length+=a;for(let n=0;n<a;++n)t[r+n]=e[n]}function appendOffset(t,e,r){let a=t.length,n=e.length;t.length+=e.length;for(let i=0;i<n;++i)t[a+i]=e[i]+r}class Geometry{constructor(){this.data=new vertexBuffer,this.Onscreen=!1,this.m=[]}offscreen(t){let e=projViewMat,r=t[0],a=r[0],n=r[1],i=r[2],s=1/(e[3]*a+e[7]*n+e[11]*i+e[15]);this.x=this.X=(e[0]*a+e[4]*n+e[8]*i+e[12])*s,this.y=this.Y=(e[1]*a+e[5]*n+e[9]*i+e[13])*s;for(let r=1,a=t.length;r<a;++r){let a=t[r],n=a[0],i=a[1],s=a[2],o=1/(e[3]*n+e[7]*i+e[11]*s+e[15]),h=(e[0]*n+e[4]*i+e[8]*s+e[12])*o,u=(e[1]*n+e[5]*i+e[9]*s+e[13])*o;h<this.x?this.x=h:h>this.X&&(this.X=h),u<this.y?this.y=u:u>this.Y&&(this.Y=u)}return(this.X<-1.01||this.x>1.01||this.Y<-1.01||this.y>1.01)&&(this.Onscreen=!1,!0)}T(t){let e=this.c[0],r=this.c[1],a=this.c[2],n=t[0]-e,i=t[1]-r,s=t[2]-a;return[n*normMat[0]+i*normMat[3]+s*normMat[6]+e,n*normMat[1]+i*normMat[4]+s*normMat[7]+r,n*normMat[2]+i*normMat[5]+s*normMat[8]+a]}Tcorners(t,e){return[this.T(t),this.T([t[0],t[1],e[2]]),this.T([t[0],e[1],t[2]]),this.T([t[0],e[1],e[2]]),this.T([e[0],t[1],t[2]]),this.T([e[0],t[1],e[2]]),this.T([e[0],e[1],t[2]]),this.T(e)]}render(){let t;if(0==this.CenterIndex?t=corners(this.Min,this.Max):(this.c=Centers[this.CenterIndex-1],t=this.Tcorners(this.Min,this.Max)),this.offscreen(t))return void this.data.clear();let e,r=this.controlpoints;if(0==this.CenterIndex){if(!remesh&&this.Onscreen)return void this.append();e=r}else{let t=r.length;e=Array(t);for(let a=0;a<t;++a)e[a]=this.T(r[a])}materialIndex=this.MaterialIndex;let a=orthographic?1:this.Min[2]/B[2],n=pixel*Math.hypot(a*(viewParam.xmax-viewParam.xmin),a*(viewParam.ymax-viewParam.ymin))/size2;this.res2=n*n,this.Epsilon=FillFactor*n,this.data.clear(),this.Onscreen=!0,this.process(e)}}class BezierPatch extends Geometry{constructor(t,e,r,a,n,i){super(),this.controlpoints=t,this.Min=a,this.Max=n,this.color=i,this.CenterIndex=e;let s=t.length;if(i){let t=i[0][3]+i[1][3]+i[2][3];this.transparent=16==s||4==s?t+i[3][3]<1020:t<765}else this.transparent=Materials[r].diffuse[3]<1;this.transparent?(this.MaterialIndex=i?-1-r:1+r,this.vertex=this.data.Vertex.bind(this.data)):(this.MaterialIndex=r,this.vertex=this.data.vertex.bind(this.data)),this.L2norm(this.controlpoints)}L2norm(t){let e=t[0];this.epsilon=0;let r=t.length;for(let a=1;a<r;++a)this.epsilon=Math.max(this.epsilon,abs2([t[a][0]-e[0],t[a][1]-e[1],t[a][2]-e[2]]));this.epsilon*=Fuzz4}processTriangle(t){let e=t[0],r=t[1],a=t[2],n=unit(cross([r[0]-e[0],r[1]-e[1],r[2]-e[2]],[a[0]-e[0],a[1]-e[1],a[2]-e[2]]));this.offscreen([e,r,a])||(this.color?(this.data.indices.push(this.data.Vertex(e,n,this.color[0])),this.data.indices.push(this.data.Vertex(r,n,this.color[1])),this.data.indices.push(this.data.Vertex(a,n,this.color[2]))):(this.data.indices.push(this.vertex(e,n)),this.data.indices.push(this.vertex(r,n)),this.data.indices.push(this.vertex(a,n))),this.append())}processQuad(t){let e=t[0],r=t[1],a=t[2],n=t[3],i=cross([r[0]-e[0],r[1]-e[1],r[2]-e[2]],[a[0]-r[0],a[1]-r[1],a[2]-r[2]]),s=cross([a[0]-n[0],a[1]-n[1],a[2]-n[2]],[n[0]-e[0],n[1]-e[1],n[2]-e[2]]),o=unit([i[0]+s[0],i[1]+s[1],i[2]+s[2]]);if(!this.offscreen([e,r,a,n])){let t,i,s,h;this.color?(t=this.data.Vertex(e,o,this.color[0]),i=this.data.Vertex(r,o,this.color[1]),s=this.data.Vertex(a,o,this.color[2]),h=this.data.Vertex(n,o,this.color[3])):(t=this.vertex(e,o),i=this.vertex(r,o),s=this.vertex(a,o),h=this.vertex(n,o)),this.data.indices.push(t),this.data.indices.push(i),this.data.indices.push(s),this.data.indices.push(t),this.data.indices.push(s),this.data.indices.push(h),this.append()}}process(t){if(10==t.length)return this.process3(t);if(3==t.length)return this.processTriangle(t);if(4==t.length)return this.processQuad(t);let e=t[0],r=t[3],a=t[12],n=t[15],i=this.normal(r,t[2],t[1],e,t[4],t[8],a);iszero(i)&&iszero(i=this.normal(r,t[2],t[1],e,t[13],t[14],n))&&(i=this.normal(n,t[11],t[7],r,t[4],t[8],a));let s=this.normal(e,t[4],t[8],a,t[13],t[14],n);iszero(s)&&iszero(s=this.normal(e,t[4],t[8],a,t[11],t[7],r))&&(s=this.normal(r,t[2],t[1],e,t[13],t[14],n));let o=this.normal(a,t[13],t[14],n,t[11],t[7],r);iszero(o)&&iszero(o=this.normal(a,t[13],t[14],n,t[2],t[1],e))&&(o=this.normal(e,t[4],t[8],a,t[11],t[7],r));let h=this.normal(n,t[11],t[7],r,t[2],t[1],e);if(iszero(h)&&iszero(h=this.normal(n,t[11],t[7],r,t[4],t[8],a))&&(h=this.normal(a,t[13],t[14],n,t[2],t[1],e)),this.color){let u=this.color[0],c=this.color[1],l=this.color[2],f=this.color[3],m=this.data.Vertex(e,i,u),d=this.data.Vertex(a,s,c),M=this.data.Vertex(n,o,l),v=this.data.Vertex(r,h,f);this.Render(t,m,d,M,v,e,a,n,r,!1,!1,!1,!1,u,c,l,f)}else{let u=this.vertex(e,i),c=this.vertex(a,s),l=this.vertex(n,o),f=this.vertex(r,h);this.Render(t,u,c,l,f,e,a,n,r,!1,!1,!1,!1)}this.data.indices.length>0&&this.append()}append(){this.transparent?transparentData.append(this.data):this.color?colorData.append(this.data):materialData.append(this.data)}Render(t,e,r,a,n,i,s,o,h,u,c,l,f,m,d,M,v){if(this.Distance(t)<this.res2)this.offscreen([i,s,o])||(this.data.indices.push(e),this.data.indices.push(r),this.data.indices.push(a)),this.offscreen([i,o,h])||(this.data.indices.push(e),this.data.indices.push(a),this.data.indices.push(n));else{if(this.offscreen(t))return;let p=t[0],g=t[3],x=t[12],b=t[15],A=new Split3(p,t[1],t[2],g),P=new Split3(t[4],t[5],t[6],t[7]),w=new Split3(t[8],t[9],t[10],t[11]),S=new Split3(x,t[13],t[14],b),R=new Split3(p,t[4],t[8],x),E=new Split3(A.m0,P.m0,w.m0,S.m0),y=new Split3(A.m3,P.m3,w.m3,S.m3),O=new Split3(A.m5,P.m5,w.m5,S.m5),I=new Split3(A.m4,P.m4,w.m4,S.m4),T=new Split3(A.m2,P.m2,w.m2,S.m2),_=new Split3(g,t[7],t[11],b),L=[p,A.m0,A.m3,A.m5,R.m0,E.m0,y.m0,O.m0,R.m3,E.m3,y.m3,O.m3,R.m5,E.m5,y.m5,O.m5],D=[R.m5,E.m5,y.m5,O.m5,R.m4,E.m4,y.m4,O.m4,R.m2,E.m2,y.m2,O.m2,x,S.m0,S.m3,S.m5],N=[O.m5,I.m5,T.m5,_.m5,O.m4,I.m4,T.m4,_.m4,O.m2,I.m2,T.m2,_.m2,S.m5,S.m4,S.m2,b],z=[A.m5,A.m4,A.m2,g,O.m0,I.m0,T.m0,_.m0,O.m3,I.m3,T.m3,_.m3,O.m5,I.m5,T.m5,_.m5],Y=L[15],q=this.normal(L[0],L[4],L[8],L[12],L[13],L[14],L[15]);iszero(q)&&iszero(q=this.normal(L[0],L[4],L[8],L[12],L[11],L[7],L[3]))&&(q=this.normal(L[3],L[2],L[1],L[0],L[13],L[14],L[15]));let V=this.normal(D[12],D[13],D[14],D[15],D[11],D[7],D[3]);iszero(V)&&iszero(V=this.normal(D[12],D[13],D[14],D[15],D[2],D[1],D[0]))&&(V=this.normal(D[0],D[4],D[8],D[12],D[11],D[7],D[3]));let B=this.normal(N[15],N[11],N[7],N[3],N[2],N[1],N[0]);iszero(B)&&iszero(B=this.normal(N[15],N[11],N[7],N[3],N[4],N[8],N[12]))&&(B=this.normal(N[12],N[13],N[14],N[15],N[2],N[1],N[0]));let F=this.normal(z[3],z[2],z[1],z[0],z[4],z[8],z[12]);iszero(F)&&iszero(F=this.normal(z[3],z[2],z[1],z[0],z[13],z[14],z[15]))&&(F=this.normal(z[15],z[11],z[7],z[3],z[4],z[8],z[12]));let C=this.normal(N[3],N[2],N[1],Y,N[4],N[8],N[12]),j=this.Epsilon,H=[.5*(i[0]+s[0]),.5*(i[1]+s[1]),.5*(i[2]+s[2])];if(!u)if(u=Straightness(p,t[4],t[8],x)<this.res2){let t=unit(this.derivative(D[0],D[1],D[2],D[3]));H=[H[0]-j*t[0],H[1]-j*t[1],H[2]-j*t[2]]}else H=L[12];let U=[.5*(s[0]+o[0]),.5*(s[1]+o[1]),.5*(s[2]+o[2])];if(!c)if(c=Straightness(x,t[13],t[14],b)<this.res2){let t=unit(this.derivative(N[12],N[8],N[4],N[0]));U=[U[0]-j*t[0],U[1]-j*t[1],U[2]-j*t[2]]}else U=D[15];let W=[.5*(o[0]+h[0]),.5*(o[1]+h[1]),.5*(o[2]+h[2])];if(!l)if(l=Straightness(b,t[11],t[7],g)<this.res2){let t=unit(this.derivative(z[15],N[14],N[13],D[12]));W=[W[0]-j*t[0],W[1]-j*t[1],W[2]-j*t[2]]}else W=N[3];let G=[.5*(h[0]+i[0]),.5*(h[1]+i[1]),.5*(h[2]+i[2])];if(!f)if(f=Straightness(p,t[1],t[2],g)<this.res2){let t=unit(this.derivative(L[3],L[7],L[11],L[15]));G=[G[0]-j*t[0],G[1]-j*t[1],G[2]-j*t[2]]}else G=z[0];if(m){let t=Array(4),p=Array(4),g=Array(4),x=Array(4),b=Array(4);for(let e=0;e<4;++e)t[e]=.5*(m[e]+d[e]),p[e]=.5*(d[e]+M[e]),g[e]=.5*(M[e]+v[e]),x[e]=.5*(v[e]+m[e]),b[e]=.5*(t[e]+g[e]);let A=this.data.Vertex(H,q,t),P=this.data.Vertex(U,V,p),w=this.data.Vertex(W,B,g),S=this.data.Vertex(G,F,x),R=this.data.Vertex(Y,C,b);this.Render(L,e,A,R,S,i,H,Y,G,u,!1,!1,f,m,t,b,x),this.Render(D,A,r,P,R,H,s,U,Y,u,c,!1,!1,t,d,p,b),this.Render(N,R,P,a,w,Y,U,o,W,!1,c,l,!1,b,p,M,g),this.Render(z,S,R,w,n,G,Y,W,h,!1,!1,l,f,x,b,g,v)}else{let t=this.vertex(H,q),m=this.vertex(U,V),d=this.vertex(W,B),M=this.vertex(G,F),v=this.vertex(Y,C);this.Render(L,e,t,v,M,i,H,Y,G,u,!1,!1,f),this.Render(D,t,r,m,v,H,s,U,Y,u,c,!1,!1),this.Render(N,v,m,a,d,Y,U,o,W,!1,c,l,!1),this.Render(z,M,v,d,n,G,Y,W,h,!1,!1,l,f)}}}process3(t){this.Res2=BezierFactor*BezierFactor*this.res2;let e=t[0],r=t[6],a=t[9],n=this.normal(a,t[5],t[2],e,t[1],t[3],r),i=this.normal(e,t[1],t[3],r,t[7],t[8],a),s=this.normal(r,t[7],t[8],a,t[5],t[2],e);if(this.color){let o=this.color[0],h=this.color[1],u=this.color[2],c=this.data.Vertex(e,n,o),l=this.data.Vertex(r,i,h),f=this.data.Vertex(a,s,u);this.Render3(t,c,l,f,e,r,a,!1,!1,!1,o,h,u)}else{let o=this.vertex(e,n),h=this.vertex(r,i),u=this.vertex(a,s);this.Render3(t,o,h,u,e,r,a,!1,!1,!1)}this.data.indices.length>0&&this.append()}Render3(t,e,r,a,n,i,s,o,h,u,c,l,f){if(this.Distance3(t)<this.Res2)this.offscreen([n,i,s])||(this.data.indices.push(e),this.data.indices.push(r),this.data.indices.push(a));else{if(this.offscreen(t))return;let m=t[0],d=t[1],M=t[2],v=t[3],p=t[4],g=t[5],x=t[6],b=t[7],A=t[8],P=t[9],w=[.5*(P[0]+g[0]),.5*(P[1]+g[1]),.5*(P[2]+g[2])],S=[.5*(P[0]+A[0]),.5*(P[1]+A[1]),.5*(P[2]+A[2])],R=[.5*(g[0]+M[0]),.5*(g[1]+M[1]),.5*(g[2]+M[2])],E=[.5*(A[0]+p[0]),.5*(A[1]+p[1]),.5*(A[2]+p[2])],y=[.5*(A[0]+b[0]),.5*(A[1]+b[1]),.5*(A[2]+b[2])],O=[.5*(M[0]+p[0]),.5*(M[1]+p[1]),.5*(M[2]+p[2])],I=[.5*(M[0]+m[0]),.5*(M[1]+m[1]),.5*(M[2]+m[2])],T=[.5*(p[0]+v[0]),.5*(p[1]+v[1]),.5*(p[2]+v[2])],_=[.5*(b[0]+x[0]),.5*(b[1]+x[1]),.5*(b[2]+x[2])],L=[.5*(m[0]+d[0]),.5*(m[1]+d[1]),.5*(m[2]+d[2])],D=[.5*(d[0]+v[0]),.5*(d[1]+v[1]),.5*(d[2]+v[2])],N=[.5*(v[0]+x[0]),.5*(v[1]+x[1]),.5*(v[2]+x[2])],z=[.5*(w[0]+R[0]),.5*(w[1]+R[1]),.5*(w[2]+R[2])],Y=[.5*(S[0]+y[0]),.5*(S[1]+y[1]),.5*(S[2]+y[2])],q=[.5*(R[0]+I[0]),.5*(R[1]+I[1]),.5*(R[2]+I[2])],V=[.5*E[0]+.25*(p[0]+d[0]),.5*E[1]+.25*(p[1]+d[1]),.5*E[2]+.25*(p[2]+d[2])],B=[.5*(y[0]+_[0]),.5*(y[1]+_[1]),.5*(y[2]+_[2])],F=[.5*O[0]+.25*(p[0]+b[0]),.5*O[1]+.25*(p[1]+b[1]),.5*O[2]+.25*(p[2]+b[2])],C=[.25*(g[0]+p[0])+.5*T[0],.25*(g[1]+p[1])+.5*T[1],.25*(g[2]+p[2])+.5*T[2]],j=[.5*(L[0]+D[0]),.5*(L[1]+D[1]),.5*(L[2]+D[2])],H=[.5*(D[0]+N[0]),.5*(D[1]+N[1]),.5*(D[2]+N[2])],U=[.5*(F[0]+j[0]),.5*(F[1]+j[1]),.5*(F[2]+j[2])],W=[.5*(F[0]+H[0]),.5*(F[1]+H[1]),.5*(F[2]+H[2])],G=[.5*(j[0]+H[0]),.5*(j[1]+H[1]),.5*(j[2]+H[2])],X=[.5*(C[0]+B[0]),.5*(C[1]+B[1]),.5*(C[2]+B[2])],Z=[.5*(Y[0]+C[0]),.5*(Y[1]+C[1]),.5*(Y[2]+C[2])],k=[.5*(Y[0]+B[0]),.5*(Y[1]+B[1]),.5*(Y[2]+B[2])],Q=[.5*(z[0]+V[0]),.5*(z[1]+V[1]),.5*(z[2]+V[2])],K=[.5*(q[0]+V[0]),.5*(q[1]+V[1]),.5*(q[2]+V[2])],$=[.5*(z[0]+q[0]),.5*(z[1]+q[1]),.5*(z[2]+q[2])],J=[m,L,I,j,[.5*(O[0]+L[0]),.5*(O[1]+L[1]),.5*(O[2]+L[2])],q,G,U,K,$],tt=[G,H,W,N,[.5*(T[0]+_[0]),.5*(T[1]+_[1]),.5*(T[2]+_[2])],X,x,_,B,k],et=[$,Q,z,Z,[.5*(w[0]+E[0]),.5*(w[1]+E[1]),.5*(w[2]+E[2])],w,k,Y,S,P],rt=[k,Z,X,Q,[.25*(R[0]+y[0]+D[0]+p[0]),.25*(R[1]+y[1]+D[1]+p[1]),.25*(R[2]+y[2]+D[2]+p[2])],W,$,K,U,G],at=this.normal(G,W,X,k,Z,Q,$),nt=this.normal(k,Z,Q,$,K,U,G),it=this.normal($,K,U,G,W,X,k),st=this.Epsilon,ot=[.5*(i[0]+s[0]),.5*(i[1]+s[1]),.5*(i[2]+s[2])];if(!o)if(o=Straightness(x,b,A,P)<this.res2){let t=unit(this.sumderivative(rt[0],rt[2],rt[5],rt[9],rt[1],rt[3],rt[6]));ot=[ot[0]-st*t[0],ot[1]-st*t[1],ot[2]-st*t[2]]}else ot=k;let ht=[.5*(s[0]+n[0]),.5*(s[1]+n[1]),.5*(s[2]+n[2])];if(!h)if(h=Straightness(m,M,g,P)<this.res2){let t=unit(this.sumderivative(rt[6],rt[3],rt[1],rt[0],rt[7],rt[8],rt[9]));ht=[ht[0]-st*t[0],ht[1]-st*t[1],ht[2]-st*t[2]]}else ht=$;let ut=[.5*(n[0]+i[0]),.5*(n[1]+i[1]),.5*(n[2]+i[2])];if(!u)if(u=Straightness(m,d,v,x)<this.res2){let t=unit(this.sumderivative(rt[9],rt[8],rt[7],rt[6],rt[5],rt[2],rt[0]));ut=[ut[0]-st*t[0],ut[1]-st*t[1],ut[2]-st*t[2]]}else ut=G;if(c){let t=Array(4),m=Array(4),d=Array(4);for(let e=0;e<4;++e)t[e]=.5*(l[e]+f[e]),m[e]=.5*(f[e]+c[e]),d[e]=.5*(c[e]+l[e]);let M=this.data.Vertex(ot,at,t),v=this.data.Vertex(ht,nt,m),p=this.data.Vertex(ut,it,d);this.Render3(J,e,p,v,n,ut,ht,!1,h,u,c,d,m),this.Render3(tt,p,r,M,ut,i,ot,o,!1,u,d,l,t),this.Render3(et,v,M,a,ht,ot,s,o,h,!1,m,t,f),this.Render3(rt,M,v,p,ot,ht,ut,!1,!1,!1,t,m,d)}else{let t=this.vertex(ot,at),c=this.vertex(ht,nt),l=this.vertex(ut,it);this.Render3(J,e,l,c,n,ut,ht,!1,h,u),this.Render3(tt,l,r,t,ut,i,ot,o,!1,u),this.Render3(et,c,t,a,ht,ot,s,o,h,!1),this.Render3(rt,t,c,l,ot,ht,ut,!1,!1,!1)}}}Distance(t){let e=t[0],r=t[3],a=t[12],n=t[15],i=Distance2(n,e,this.normal(r,t[2],t[1],e,t[4],t[8],a));return i=Math.max(i,Straightness(e,t[1],t[2],r)),i=Math.max(i,Straightness(e,t[4],t[8],a)),i=Math.max(i,Straightness(r,t[7],t[11],n)),i=Math.max(i,Straightness(a,t[13],t[14],n)),i=Math.max(i,Straightness(t[4],t[5],t[6],t[7])),i=Math.max(i,Straightness(t[8],t[9],t[10],t[11])),i=Math.max(i,Straightness(t[1],t[5],t[9],t[13])),Math.max(i,Straightness(t[2],t[6],t[10],t[14]))}Distance3(t){let e=t[0],r=t[4],a=t[6],n=t[9],i=abs2([(e[0]+a[0]+n[0])*third-r[0],(e[1]+a[1]+n[1])*third-r[1],(e[2]+a[2]+n[2])*third-r[2]]);return i=Math.max(i,Straightness(e,t[1],t[3],a)),i=Math.max(i,Straightness(e,t[2],t[5],n)),Math.max(i,Straightness(a,t[7],t[8],n))}derivative(t,e,r,a){let n=[e[0]-t[0],e[1]-t[1],e[2]-t[2]];if(abs2(n)>this.epsilon)return n;let i=bezierPP(t,e,r);return abs2(i)>this.epsilon?i:bezierPPP(t,e,r,a)}sumderivative(t,e,r,a,n,i,s){let o=this.derivative(t,e,r,a),h=this.derivative(t,n,i,s);return[o[0]+h[0],o[1]+h[1],o[2]+h[2]]}normal(t,e,r,a,n,i,s){let o=n[0]-a[0],h=n[1]-a[1],u=n[2]-a[2],c=r[0]-a[0],l=r[1]-a[1],f=r[2]-a[2],m=[h*f-u*l,u*c-o*f,o*l-h*c];if(abs2(m)>this.epsilon)return unit(m);let d=[c,l,f],M=[o,h,u],v=bezierPP(a,r,e),p=bezierPP(a,n,i),g=cross(p,d),x=cross(M,v);if(abs2(m=[g[0]+x[0],g[1]+x[1],g[2]+x[2]])>this.epsilon)return unit(m);let b=bezierPPP(a,r,e,t),A=bezierPPP(a,n,i,s);g=cross(p,v),x=cross(M,b);let P=cross(A,d),w=cross(A,v),S=cross(p,b),R=cross(A,b);return unit([9*g[0]+3*(x[0]+P[0]+w[0]+S[0])+R[0],9*g[1]+3*(x[1]+P[1]+w[1]+S[1])+R[1],9*g[2]+3*(x[2]+P[2]+w[2]+S[2])+R[2]])}}class BezierCurve extends Geometry{constructor(t,e,r,a,n){super(),this.controlpoints=t,this.Min=a,this.Max=n,this.CenterIndex=e,this.MaterialIndex=r}processLine(t){let e=t[0],r=t[1];this.offscreen([e,r])||(this.data.indices.push(this.data.vertex1(e)),this.data.indices.push(this.data.vertex1(r)),this.append())}process(t){if(2==t.length)return this.processLine(t);let e=this.data.vertex1(t[0]),r=this.data.vertex1(t[3]);this.Render(t,e,r),this.data.indices.length>0&&this.append()}append(){material1Data.append(this.data)}Render(t,e,r){let a=t[0],n=t[1],i=t[2],s=t[3];if(Straightness(a,n,i,s)<this.res2)this.offscreen([a,s])||(this.data.indices.push(e),this.data.indices.push(r));else{if(this.offscreen(t))return;let o=[.5*(a[0]+n[0]),.5*(a[1]+n[1]),.5*(a[2]+n[2])],h=[.5*(n[0]+i[0]),.5*(n[1]+i[1]),.5*(n[2]+i[2])],u=[.5*(i[0]+s[0]),.5*(i[1]+s[1]),.5*(i[2]+s[2])],c=[.5*(o[0]+h[0]),.5*(o[1]+h[1]),.5*(o[2]+h[2])],l=[.5*(h[0]+u[0]),.5*(h[1]+u[1]),.5*(h[2]+u[2])],f=[.5*(c[0]+l[0]),.5*(c[1]+l[1]),.5*(c[2]+l[2])],m=[a,o,c,f],d=[f,l,u,s],M=this.data.vertex1(f);this.Render(m,e,M),this.Render(d,M,r)}}}class Pixel extends Geometry{constructor(t,e,r,a,n){super(),this.controlpoint=t,this.width=e,this.CenterIndex=0,this.MaterialIndex=r,this.Min=a,this.Max=n}process(t){this.data.indices.push(this.data.vertex0(this.controlpoint,this.width)),this.append()}append(){material0Data.append(this.data)}}class Triangles extends Geometry{constructor(t,e,r){super(),this.CenterIndex=0,this.MaterialIndex=t,this.Min=e,this.Max=r,this.Positions=Positions,this.Normals=Normals,this.Colors=Colors,this.Indices=Indices,Positions=[],Normals=[],Colors=[],Indices=[],this.transparent=Materials[t].diffuse[3]<1}process(t){for(let t=0,e=this.Indices.length;t<e;++t){let e=this.Indices[t],r=e[0],a=this.Positions[r[0]],n=this.Positions[r[1]],i=this.Positions[r[2]];if(!this.offscreen([a,n,i])){let t=e.length>1?e[1]:r;if(t&&0!=t.length||(t=r),this.Colors.length>0){let s=e.length>2?e[2]:r;s&&0!=s.length||(s=r);let o=this.Colors[s[0]],h=this.Colors[s[1]],u=this.Colors[s[2]];this.transparent|=o[3]+h[3]+u[3]<765,materialIndex=-1-this.MaterialIndex,this.data.iVertex(r[0],a,this.Normals[t[0]],o),this.data.iVertex(r[1],n,this.Normals[t[1]],h),this.data.iVertex(r[2],i,this.Normals[t[2]],u)}else materialIndex=1+this.MaterialIndex,this.data.iVertex(r[0],a,this.Normals[t[0]]),this.data.iVertex(r[1],n,this.Normals[t[1]]),this.data.iVertex(r[2],i,this.Normals[t[2]])}}this.data.nvertices=this.Positions.length,this.data.indices.length>0&&this.append()}append(){this.transparent?transparentData.append(this.data):triangleData.append(this.data)}}function home(){mat4.identity(rotMat),initProjection(),setProjection(),redraw=!0}function initShader(t=[]){let e=getShader(gl,"fragment",t),r=getShader(gl,"vertex",t),a=gl.createProgram();return gl.attachShader(a,r),gl.attachShader(a,e),gl.linkProgram(a),gl.getProgramParameter(a,gl.LINK_STATUS)||alert("Could not initialize shaders"),a}class Split3{constructor(t,e,r,a){this.m0=[.5*(t[0]+e[0]),.5*(t[1]+e[1]),.5*(t[2]+e[2])];let n=.5*(e[0]+r[0]),i=.5*(e[1]+r[1]),s=.5*(e[2]+r[2]);this.m2=[.5*(r[0]+a[0]),.5*(r[1]+a[1]),.5*(r[2]+a[2])],this.m3=[.5*(this.m0[0]+n),.5*(this.m0[1]+i),.5*(this.m0[2]+s)],this.m4=[.5*(n+this.m2[0]),.5*(i+this.m2[1]),.5*(s+this.m2[2])],this.m5=[.5*(this.m3[0]+this.m4[0]),.5*(this.m3[1]+this.m4[1]),.5*(this.m3[2]+this.m4[2])]}}function iszero(t){return 0==t[0]&&0==t[1]&&0==t[2]}function unit(t){let e=1/(Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])||1);return[t[0]*e,t[1]*e,t[2]*e]}function abs2(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cross(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function bezierPP(t,e,r){return[t[0]+r[0]-2*e[0],t[1]+r[1]-2*e[1],t[2]+r[2]-2*e[2]]}function bezierPPP(t,e,r,a){return[a[0]-t[0]+3*(e[0]-r[0]),a[1]-t[1]+3*(e[1]-r[1]),a[2]-t[2]+3*(e[2]-r[2])]}function Straightness(t,e,r,a){let n=[third*(a[0]-t[0]),third*(a[1]-t[1]),third*(a[2]-t[2])];return Math.max(abs2([e[0]-n[0]-t[0],e[1]-n[1]-t[1],e[2]-n[2]-t[2]]),abs2([a[0]-n[0]-r[0],a[1]-n[1]-r[1],a[2]-n[2]-r[2]]))}function Distance2(t,e,r){let a=dot([t[0]-e[0],t[1]-e[1],t[2]-e[2]],r);return a*a}function corners(t,e){return[t,[t[0],t[1],e[2]],[t[0],e[1],t[2]],[t[0],e[1],e[2]],[e[0],t[1],t[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],e]}function COBTarget(t,e){mat4.fromTranslation(translMat,[center.x,center.y,center.z]),mat4.invert(cjMatInv,translMat),mat4.multiply(t,e,cjMatInv),mat4.multiply(t,translMat,t)}function setUniforms(t){let e=t==pixelShader;gl.useProgram(t),t.vertexPositionAttribute=gl.getAttribLocation(t,"position"),gl.enableVertexAttribArray(t.vertexPositionAttribute),e&&(t.vertexWidthAttribute=gl.getAttribLocation(t,"width"),gl.enableVertexAttribArray(t.vertexWidthAttribute)),t==noNormalShader||e||(t.vertexNormalAttribute=gl.getAttribLocation(t,"normal"),gl.enableVertexAttribArray(t.vertexNormalAttribute)),t.vertexMaterialAttribute=gl.getAttribLocation(t,"materialIndex"),gl.enableVertexAttribArray(t.vertexMaterialAttribute),t.projViewMatUniform=gl.getUniformLocation(t,"projViewMat"),t.viewMatUniform=gl.getUniformLocation(t,"viewMat"),t.normMatUniform=gl.getUniformLocation(t,"normMat"),t!=colorShader&&t!=transparentShader||(t.vertexColorAttribute=gl.getAttribLocation(t,"color"),gl.enableVertexAttribArray(t.vertexColorAttribute));for(let e=0;e<Materials.length;++e)Materials[e].setUniform(t,"Materials",e);for(let e=0;e<Lights.length;++e)Lights[e].setUniform(t,"Lights",e);gl.uniformMatrix4fv(t.projViewMatUniform,!1,projViewMat),gl.uniformMatrix4fv(t.viewMatUniform,!1,viewMat),gl.uniformMatrix3fv(t.normMatUniform,!1,normMat)}function handleMouseDown(t){mouseDownOrTouchActive=!0,lastMouseX=t.clientX,lastMouseY=t.clientY}let pinchStart,touchStartTime,pinch=!1;function pinchDistance(t){return Math.hypot(t[0].pageX-t[1].pageX,t[0].pageY-t[1].pageY)}function handleTouchStart(t){t.preventDefault();let e=t.targetTouches;swipe=rotate=pinch=!1,zooming||(1!=e.length||mouseDownOrTouchActive||(touchStartTime=(new Date).getTime(),touchId=e[0].identifier,lastMouseX=e[0].pageX,lastMouseY=e[0].pageY),2!=e.length||mouseDownOrTouchActive||(touchId=e[0].identifier,pinchStart=pinchDistance(e),pinch=!0))}function handleMouseUpOrTouchEnd(t){mouseDownOrTouchActive=!1}function rotateScene(t,e,r,a,n){if(t==r&&e==a)return;let[i,s]=arcball([t,-e],[r,-a]);mat4.fromRotation(rotMats,2*n*i/lastzoom,s),mat4.multiply(rotMat,rotMats,rotMat)}function shiftScene(t,e,r,a){let n=1/lastzoom;shift.x+=(r-t)*n*halfCanvasWidth,shift.y-=(a-e)*n*halfCanvasHeight}function panScene(t,e,r,a){orthographic?shiftScene(t,e,r,a):(center.x+=(r-t)*(viewParam.xmax-viewParam.xmin),center.y-=(a-e)*(viewParam.ymax-viewParam.ymin))}function updateViewMatrix(){COBTarget(viewMat,rotMat),mat4.translate(viewMat,viewMat,[center.x,center.y,0]),mat3.fromMat4(viewMat3,viewMat),mat3.invert(normMat,viewMat3),mat4.multiply(projViewMat,projMat,viewMat)}function capzoom(){let t=Math.sqrt(Number.MAX_VALUE),e=1/t;Zoom<=e&&(Zoom=e),Zoom>=t&&(Zoom=t),Zoom!=lastzoom&&(remesh=!0),lastzoom=Zoom}function zoomImage(t){let e=zoomStep*halfCanvasHeight*t;const r=Math.log(.1*Number.MAX_VALUE)/Math.log(zoomFactor);Math.abs(e)<r&&(Zoom*=zoomFactor**e,capzoom())}function normMouse(t){let e=t[0],r=t[1],a=Math.hypot(e,r);return a>1&&(denom=1/a,e*=denom,r*=denom),[e,r,Math.sqrt(Math.max(1-r*r-e*e,0))]}function arcball(t,e){let r=normMouse(t),a=normMouse(e),n=dot(r,a);return n>1?n=1:n<-1&&(n=-1),[Math.acos(n),unit(cross(r,a))]}function zoomScene(t,e,r,a){zoomImage(e-a)}const DRAGMODE_ROTATE=1,DRAGMODE_SHIFT=2,DRAGMODE_ZOOM=3,DRAGMODE_PAN=4;function processDrag(t,e,r,a=1){let n;switch(r){case DRAGMODE_ROTATE:n=rotateScene;break;case DRAGMODE_SHIFT:n=shiftScene;break;case DRAGMODE_ZOOM:n=zoomScene;break;case DRAGMODE_PAN:n=panScene;break;default:n=((t,e,r,a)=>{})}n((lastMouseX-halfCanvasWidth)/halfCanvasWidth,(lastMouseY-halfCanvasHeight)/halfCanvasHeight,(t-halfCanvasWidth)/halfCanvasWidth,(e-halfCanvasHeight)/halfCanvasHeight,a),lastMouseX=t,lastMouseY=e,setProjection(),redraw=!0}function handleKey(t){let e=[];switch(t.key){case"x":e=[1,0,0];break;case"y":e=[0,1,0];break;case"z":e=[0,0,1];break;case"h":home();break;case"+":case"=":case">":expand();break;case"-":case"_":case"<":shrink()}e.length>0&&(mat4.rotate(rotMat,rotMat,.1,e),updateViewMatrix(),redraw=!0)}function handleMouseWheel(t){t.deltaY<0?Zoom*=zoomFactor:Zoom/=zoomFactor,capzoom(),setProjection(),redraw=!0}function handleMouseMove(t){if(!mouseDownOrTouchActive)return;let e;processDrag(t.clientX,t.clientY,e=t.getModifierState("Control")?DRAGMODE_SHIFT:t.getModifierState("Shift")?DRAGMODE_ZOOM:t.getModifierState("Alt")?DRAGMODE_PAN:DRAGMODE_ROTATE)}let indexExt,zooming=!1,swipe=!1,rotate=!1;function handleTouchMove(t){if(t.preventDefault(),zooming)return;let e=t.targetTouches;if(!pinch&&1==e.length&&touchId==e[0].identifier){let t=e[0].pageX,r=e[0].pageY,a=t-lastMouseX,n=r-lastMouseY,i=a*a+n*n<=shiftHoldDistance*shiftHoldDistance;if(i&&!swipe&&!rotate&&(new Date).getTime()-touchStartTime>shiftWaitTime&&(navigator.vibrate&&window.navigator.vibrate(vibrateTime),swipe=!0),swipe)processDrag(t,r,DRAGMODE_SHIFT);else if(!i){rotate=!0,processDrag(e[0].pageX,e[0].pageY,DRAGMODE_ROTATE,.5)}}if(pinch&&!swipe&&2==e.length&&touchId==e[0].identifier){let t=pinchDistance(e),r=t-pinchStart;zooming=!0,(r*=zoomPinchFactor)>zoomPinchCap&&(r=zoomPinchCap),r<-zoomPinchCap&&(r=-zoomPinchCap),zoomImage(r/size2),pinchStart=t,swipe=rotate=zooming=!1,setProjection(),redraw=!0}}function setBuffer(){positionBuffer=gl.createBuffer(),materialBuffer=gl.createBuffer(),colorBuffer=gl.createBuffer(),indexBuffer=gl.createBuffer(),indexExt=gl.getExtension("OES_element_index_uint")}let pixelShader,noNormalShader,materialShader,colorShader,transparentShader,zbuffer=[];function transformVertices(t){let e=viewMat[2],r=viewMat[6],a=viewMat[10];zbuffer.length=t.length;for(let n=0;n<t.length;++n){let i=6*n;zbuffer[n]=e*t[i]+r*t[i+1]+a*t[i+2]}}function draw(){gl.clearColor(1,1,1,1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),material0Data.clear(),material1Data.clear(),materialData.clear(),colorData.clear(),triangleData.clear(),transparentData.clear(),P.forEach(function(t){t.render()}),drawBuffer(material0Data,pixelShader),drawBuffer(material1Data,noNormalShader),drawBuffer(materialData,materialShader),drawBuffer(colorData,colorShader),drawBuffer(triangleData,transparentShader);let t=transparentData.indices;if(t.length>0){transformVertices(transparentData.vertices);let e=t.length/3,r=Array(e).fill().map((t,e)=>e);r.sort(function(e,r){let a=3*e;Ia=t[a],Ib=t[a+1],Ic=t[a+2];let n=3*r;return IA=t[n],IB=t[n+1],IC=t[n+2],zbuffer[Ia]+zbuffer[Ib]+zbuffer[Ic]<zbuffer[IA]+zbuffer[IB]+zbuffer[IC]?-1:1});let a=Array(t.length);for(let n=0;n<e;++n){let e=3*r[n];a[3*n]=t[e],a[3*n+1]=t[e+1],a[3*n+2]=t[e+2]}gl.depthMask(!1),drawBuffer(transparentData,transparentShader,a),gl.depthMask(!0)}remesh=!1}function tick(){requestAnimationFrame(tick),redraw&&(draw(),redraw=!1)}function setDimensions(t,e,r,a){let n=t/e,i=1/lastzoom,s=r/t*lastzoom,o=a/e*lastzoom;if(orthographic){let t=B[0]-b[0],e=B[1]-b[1];if(t<e*n){let t=.5*e*n*i,r=2*t*s,a=e*i*o;viewParam.xmin=-t-r,viewParam.xmax=t-r,viewParam.ymin=b[1]*i-a,viewParam.ymax=B[1]*i-a}else{let e=.5*t/(n*Zoom),r=t*i*s,a=2*e*o;viewParam.xmin=b[0]*i-r,viewParam.xmax=B[0]*i-r,viewParam.ymin=-e-a,viewParam.ymax=e-a}}else{let t=H*i,e=t*n,r=2*e*s,a=2*t*o;viewParam.xmin=-e-r,viewParam.xmax=e-r,viewParam.ymin=-t-a,viewParam.ymax=t-a}}function setProjection(){setDimensions(canvasWidth,canvasHeight,shift.x,shift.y),(orthographic?mat4.ortho:mat4.frustum)(projMat,viewParam.xmin,viewParam.xmax,viewParam.ymin,viewParam.ymax,-viewParam.zmax,-viewParam.zmin),updateViewMatrix()}function initProjection(){H=-Math.tan(.5*angle)*B[2],center.x=center.y=0,center.z=.5*(b[2]+B[2]),lastzoom=Zoom=Zoom0,viewParam.zmin=b[2],viewParam.zmax=B[2],shift.x=shift.y=0}function setViewport(){gl.viewportWidth=canvasWidth,gl.viewportHeight=canvasHeight,gl.viewport(0,0,gl.viewportWidth,gl.viewportHeight),home()}function setCanvas(){canvas.width=canvasWidth,canvas.height=canvasHeight,size2=Math.hypot(canvasWidth,canvasHeight),halfCanvasWidth=.5*canvasWidth,halfCanvasHeight=.5*canvasHeight}function setsize(t,e){t>maxViewportWidth&&(t=maxViewportWidth),e>maxViewportHeight&&(e=maxViewportHeight),canvasWidth=t,canvasHeight=e,setCanvas(),setViewport()}function expand(){setsize(canvasWidth*resizeStep+.5,canvasHeight*resizeStep+.5)}function shrink(){setsize(Math.max(canvasWidth/resizeStep+.5,1),Math.max(canvasHeight/resizeStep+.5,1))}function webGLStart(){canvas=document.getElementById("Asymptote"),devicepixels&&(canvasWidth*=window.devicePixelRatio,canvasHeight*=window.devicePixelRatio),canvas.width>0&&(canvasWidth=canvas.width),canvas.height>0&&(canvasHeight=canvas.height),setCanvas(),initGL(),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.enable(gl.DEPTH_TEST),setViewport(),noNormalShader=initShader(),pixelShader=initShader(["WIDTH"]),materialShader=initShader(["NORMAL"]),colorShader=initShader(["NORMAL","COLOR"]),transparentShader=initShader(["NORMAL","COLOR","TRANSPARENT"]),setBuffer(),canvas.onmousedown=handleMouseDown,document.onmouseup=handleMouseUpOrTouchEnd,document.onmousemove=handleMouseMove,canvas.onkeydown=handleKey,document.onwheel=handleMouseWheel,canvas.addEventListener("touchstart",handleTouchStart,!1),canvas.addEventListener("touchend",handleMouseUpOrTouchEnd,!1),canvas.addEventListener("touchcancel",handleMouseUpOrTouchEnd,!1),canvas.addEventListener("touchleave",handleMouseUpOrTouchEnd,!1),canvas.addEventListener("touchmove",handleTouchMove,!1),document.addEventListener("keydown",handleKey,!1),tick()}